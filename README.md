# AllMap 模组 - 丝之歌全地图解锁

## 功能介绍

AllMap 模组可以在玩家进入游戏时自动解锁全地图，让您无需探索即可查看完整的游戏地图。

### 主要功能

1. **自动给予羽毛笔** - 确保玩家拥有查看地图的基本工具
2. **开启全房间显示** - 设置 `mapAllRooms = true`，显示所有房间布局
3. **映射当前场景** - 自动将当前场景添加到已访问和已映射列表
4. **智能检测** - 只在游戏世界中生效，不影响菜单界面

## 安装方法

### 前置要求

- Hollow Knight: Silksong 游戏
- BepInEx 5.x 框架

### 安装步骤

1. **安装BepInEx**（如果还没有安装）
   - 下载适用于Unity游戏的BepInEx 5.x版本
   - 解压到游戏根目录
   - 运行游戏一次以生成必要文件

2. **安装AllMap模组**
   - 下载 `AllMap.dll` 文件
   - 将DLL文件放入 `BepInEx/plugins/` 目录
   - 启动游戏即可

## 配置选项

模组配置文件位置：`BepInEx/config/allmap.cfg`

### 可用配置项

```ini
[General]
# 是否启用全地图功能
EnableAllMap = true

[Debug]
# 是否启用调试日志（用于故障排除）
EnableDebugLog = false
```

## 使用说明

### 基本使用

1. **安装模组后启动游戏**
2. **进入任何存档**（新档或旧档都可以）
3. **等待5-10秒**，模组会自动检测游戏状态
4. **打开背包查看地图**，应该可以看到全地图已开启

### 配置修改

1. 游戏运行一次后，配置文件会自动生成
2. 关闭游戏，编辑 `BepInEx/config/allmap.cfg` 文件
3. 修改配置项后重新启动游戏生效

### 功能验证

- 打开背包中的地图，应该能看到完整的地图布局
- 地图上会显示所有房间的形状和连接
- 当前所在位置会正确标记

## 技术实现

### 核心机制

- 使用Unity的Update循环检测游戏状态
- 智能识别游戏世界场景（排除菜单界面）
- 一次性应用设置，避免重复执行

### 地图解锁原理

1. **给予羽毛笔**: `PlayerData.hasQuill = true`
2. **设置羽毛笔状态**: `PlayerData.QuillState = 1`
3. **开启全房间显示**: `PlayerData.mapAllRooms = true`
4. **映射当前场景**: 添加到 `scenesMapped` 和 `scenesVisited` 集合

### 安全设计

- 只修改必要的地图相关数据
- 不影响游戏进度和成就
- 包含异常处理，避免游戏崩溃

## 故障排除

### 常见问题

1. **模组没有生效**

   ```
   解决方案：
   - 确认BepInEx正确安装（游戏根目录应有BepInEx文件夹）
   - 检查AllMap.dll是否在 BepInEx/plugins/ 目录中
   - 查看BepInEx控制台或日志文件是否有错误信息
   ```

2. **地图没有完全显示**

   ```
   解决方案：
   - 等待更长时间（最多30秒）让模组检测游戏状态
   - 尝试切换场景或重新进入存档
   - 检查配置文件中EnableAllMap是否为true
   ```

3. **游戏启动异常**

   ```
   解决方案：
   - 临时移除AllMap.dll，确认是否为模组问题
   - 检查是否缺少依赖文件（MonoMod.*.dll）
   - 查看BepInEx日志获取详细错误信息
   ```

### 日志查看

**BepInEx控制台**：游戏启动时会显示黑色控制台窗口，可以看到模组加载信息

**日志文件位置**：`BepInEx/LogOutput.log`

**模组成功加载的标志**：

```
[Info   :   All Map] AllMap模组已加载
[Info   :   All Map] 检测到游戏状态，应用全地图
[Info   :   All Map] 开始应用全地图功能
[Info   :   All Map] 设置核心地图标志完成
[Info   :   All Map] 全地图功能已应用
```

## 兼容性说明

- ✅ **与其他模组兼容**：设计简洁，不会与其他模组冲突
- ✅ **存档安全**：只修改地图显示，不影响游戏进度
- ✅ **可安全卸载**：删除DLL文件即可完全移除
- ✅ **游戏版本**：适用于Hollow Knight: Silksong

## 开发信息

- **开发语言**: C#
- **框架依赖**: BepInEx 5.x
- **游戏版本**: Hollow Knight: Silksong
- **模组版本**: 1.0.0
- **文件大小**: 7KB

## 更新日志

### v1.0.0 (当前版本)

- ✨ 实现核心全地图解锁功能
- 🎯 简化代码结构，提高稳定性
- 🛡️ 添加异常处理，防止游戏崩溃
- 📝 提供详细的使用说明和故障排除指南

## 许可证

本模组仅供学习和个人使用，请勿用于商业用途。

## 致谢

感谢 Team Cherry 开发的精彩游戏，以及 BepInEx 框架的开发者们。
